# Yes, My Road - AI 기반 도로 안전 솔루션

[![Flutter](https://img.shields.io/badge/Flutter-3.0+-02569B?logo=flutter&logoColor=white)](https://flutter.dev/)
[![Dart](https://img.shields.io/badge/Dart-3.7+-0175C2?logo=dart&logoColor=white)](https://dart.dev/)
[![TensorFlow Lite](https://img.shields.io/badge/TensorFlow%20Lite-0.11.0-FF6F00?logo=tensorflow&logoColor=white)](https://www.tensorflow.org/lite)
[![Camera](https://img.shields.io/badge/Camera-0.10.5-4CAF50?logo=camera&logoColor=white)](https://pub.dev/packages/camera)
[![Android](https://img.shields.io/badge/Android-8.0+-3DDC84?logo=android&logoColor=white)](https://developer.android.com/)

> **AI 기반 도로 안전 솔루션**

## 담당자

- **Mobile Developer**: 김동휘

## 프로젝트 개요

Yes, My Road는 **YOLO 객체 탐지 모델**과 **멀티 센서 데이터 융합**을 통해 실시간으로 도로 손상을 감지하는 Flutter 모바일 애플리케이션입니다. **Isolate 기반 백그라운드 처리**, **속도 기반 적응형 프레임 스케줄링**, **다중 포맷 이미지 파이프라인**을 구현하여 안정적인 실시간 감지 시스템을 제공합니다.

## 시스템 아키텍처

```
┌─────────────────────────────────┐
│           UI 레이어             │
├─────────────────────────────────┤
│ 홈 화면 │ 감지 화면 │ 관리 화면 │
└─────────────────────────────────┘
                 │
┌─────────────────────────────────┐
│         서비스 레이어           │
├─────────────────────────────────┤
│ 감지 서비스 │ 위치 서비스 │ API │
└─────────────────────────────────┘
                 │
┌─────────────────────────────────┐
│        처리 파이프라인          │
├─────────────────────────────────┤
│ 이미지 변환 │ AI 추론 │ NMS    │
└─────────────────────────────────┘
                 │
┌─────────────────────────────────┐
│        하드웨어 레이어          │
├─────────────────────────────────┤
│  카메라  │   GPS   │ 가속도계   │
└─────────────────────────────────┘
```

## 기술 스택

| 범주 | 기술 | 버전 | 비고 |
|------|------|------|------|
| **언어** | Dart | 3.7+ | Flutter 개발 언어 |
| **프레임워크** | Flutter | 3.0+ | 크로스 플랫폼 모바일 개발 |
| **AI/ML** | TensorFlow Lite | 0.11.0 | 모바일 최적화 추론 엔진 |
| **객체 탐지** | YOLO Model | Float32 | 포트홀·균열 감지 |
| **이미지 처리** | image | 4.1.3 | 다중 포맷 변환 및 전처리 |
| **카메라** | camera | 0.10.5+ | 실시간 스트림 처리 |
| **위치** | geolocator | 11.0.0 | GPS 위치 서비스 |
| **센서** | sensors_plus | 3.0.2 | 가속도계 데이터 |
| **네트워크** | http | 1.1.0 | REST API 통신 |
| **권한** | permission_handler | 11.1.0 | 카메라/위치 권한 관리 |
| **파일 시스템** | path_provider | 2.1.1 | 로컬 저장소 접근 |
| **날짜 처리** | intl | 0.18.1 | 다국어 날짜 포맷 |

## 핵심 기능

### **AI/ML 파이프라인**
- **TensorFlow Lite**: 모바일 최적화 추론 엔진
- **YOLO 객체 탐지 모델**: 포트홀·균열 감지용 Float32 모델
- **커스텀 NMS 구현**: IoU 기반 중복 제거 알고리즘
- **Isolate 기반 처리**: 메인 UI 스레드와 분리된 백그라운드 추론

### **이미지 처리**
- **다중 포맷 지원**: YUV420, BGRA8888, JPEG, NV21 자동 감지 및 변환
- **적응형 전처리**: 224×224 리사이징 및 패딩
- **실시간 좌표 변환**: 모델 출력을 화면 좌표계로 변환
- **메모리 효율성**: 이미지 버퍼 재사용 및 점진적 해제

### **센서 융합**
- **GPS + 가속도계**: 위치 및 속도 데이터 가중 평균 융합 (GPS 70% + 가속도계 30%)
- **적응형 샘플링**: 속도에 따른 센서 폴링 최적화
- **모션 감지**: 가속도계 기반 차량 상태 분석

## 핵심 기능 및 동작 플로우

### 1. **실시간 AI 감지 파이프라인**

```
카메라 스트림 → 포맷 변환 → 전처리 → AI 추론 → NMS → 좌표 변환 → 결과 표시
```

**처리 단계:**
1. **이미지 캡처**: 카메라 스트림에서 프레임 수신
2. **포맷 변환**: 플랫폼별 이미지 포맷 자동 감지 및 RGB 변환
3. **전처리**: 224×224 크기 리사이징, 제로 패딩, 정규화
4. **AI 추론**: TensorFlow Lite를 통한 YOLO 모델 실행
5. **후처리**: 신뢰도 0.6 이상 필터링, IoU 0.2 기준 NMS 적용
6. **결과 표시**: 실시간 바운딩 박스 오버레이

### 2. **속도 적응형 스케줄링**

```
속도 감지 → 프레임 스킵 계산 → 처리 스케줄 조정 → 배터리 최적화
```

**프레임 스킵 로직:**
- **20km/h 미만**: 15프레임 스킵 (16프레임마다 처리)
- **20-50km/h**: 7프레임 스킵 (8프레임마다 처리)
- **50km/h 이상**: 3프레임 스킵 (4프레임마다 처리)

### 3. **데이터 처리 파이프라인**

```
감지 결과 → 메타데이터 생성 → 로컬 저장 → 배치 업로드 → 자동 정리
```

**최적화 전략:**
- **비동기 I/O**: 이미지 저장과 동시 프레임 처리
- **JPEG 압축**: 품질 85% 설정으로 저장 공간 절약
- **배치 업로드**: 네트워크 상태 기반 큐잉
- **자동 정리**: 업로드 완료 후 로컬 데이터 삭제

## 성능 최적화

### **메모리 관리**
- **프레임 큐 제한**: 최대 12개 프레임 대기열로 메모리 사용량 제한
- **이미지 버퍼 재사용**: 메모리 할당/해제 오버헤드 최소화
- **점진적 가비지 컬렉션**: 작은 단위로 메모리 해제

### **처리 성능**
- **백그라운드 Isolate**: AI 추론을 별도 스레드에서 실행
- **큐 상태 모니터링**: 실시간 처리 대기열 및 성능 지표 추적
- **동적 처리량 조절**: 시스템 부하에 따른 자동 조절

### **배터리 효율성**
- **속도 기반 처리**: 차량 속도에 따른 처리 빈도 조절
- **센서 최적화**: 불필요한 센서 비활성화
- **절전 모드**: 백그라운드 상태에서 자동 절전

## 전체 시스템 플로우

```
[사용자] → [UI 레이어] → [감지 서비스] 
    ↓
[실시간 처리 루프]
    ├─ [AI 엔진]: 이미지 전처리 → YOLO 추론 → NMS 후처리
    ├─ [위치 서비스]: GPS + 가속도계 데이터 수집
    ├─ [저장소]: 결과 로컬 저장
    └─ [UI]: 실시간 시각화
```

## 프로젝트 구조

```
lib/
├── main.dart                           # 앱 진입점, 권한 초기화
├── screens/                            # 사용자 인터페이스
│   ├── home_screen.dart                # 메인 대시보드
│   ├── detection_screen.dart           # 실시간 감지 + 성능 모니터링
│   ├── recording_detection_screen.dart # 속도 기반 녹화 모드
│   └── record_management_screen.dart   # 로컬 데이터 관리
├── services/                           # 앱 주요 기능
│   ├── detection_service.dart          # 기본 AI 감지 (Isolate 기반)
│   ├── speed_based_detection_service.dart # 속도 적응형 감지
│   ├── location_service.dart           # GPS 위치 서비스
│   ├── local_storage_service.dart      # 로컬 데이터 CRUD
│   └── api_service.dart                # HTTP API 클라이언트
├── utils/                              # 핵심 알고리즘
│   ├── image_converter.dart            # 다중 포맷 이미지 처리
│   ├── nms.dart                        # 비최대 억제 구현
│   ├── frame_rate_tester.dart          # FPS 측정 도구
│   └── screen_utils.dart               # 화면 관련 유틸리티
├── models/                             # 데이터 모델
│   ├── detection_result.dart           # 감지 결과 데이터 객체
│   └── local_detection_record.dart     # 로컬 저장 레코드
└── widgets/                            # UI 컴포넌트
    ├── bounding_box.dart               # 감지 결과 오버레이
    └── custom_app_bar.dart             # 공통 앱바
```

## 설치 및 실행

### **시스템 요구사항**
- Flutter SDK 3.0 이상
- Dart SDK 3.7 이상
- Android 8.0 (API 26) 이상
- 카메라, 위치, 저장소 접근 권한

### **설치 과정**
```bash
# 저장소 클론
git clone [repository-url]

# 프로젝트 디렉토리 이동
cd safeway

# 의존성 설치
flutter pub get

# 개발 모드 실행
flutter run

# 릴리즈 빌드
flutter build apk --release
```

## 기술적 특징

### **1. 이미지 처리**
- **포맷 무관 처리**: 런타임에 카메라 포맷 자동 감지 및 최적 변환
- **메모리 안전성**: 버퍼 오버플로우 방지 및 안전한 포인터 참조
- **에러 복구**: 이미지 변환 실패 시 graceful fallback

### **2. 실시간 성능 모니터링**
- **큐 상태 시각화**: 처리 대기열 크기 및 상태 실시간 표시
- **처리 시간 추적**: 평균, 최대, 최근 처리 시간 통계
- **FPS 측정**: 실제 처리 성능 모니터링

### **3. 데이터 무결성**
- **트랜잭션 기반 저장**: 원자적 데이터 저장 보장
- **중복 업로드 방지**: 상태 기반 업로드 관리
- **오프라인 지원**: 네트워크 연결 없이도 로컬 저장 지속

---